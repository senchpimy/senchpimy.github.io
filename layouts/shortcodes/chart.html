<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{{ $id := index (seq 1000 | shuffle) 0 }}
<div style="position: relative; height:40vh; width:80vw; max-width: 800px; max-height: 400px; margin: 20px auto;">
    <canvas id="chart-{{ $id }}"></canvas>
</div>

<script>
(function() {
    var ctx = document.getElementById('chart-{{ $id }}').getContext('2d');
    var chartConfig = {{ .Inner | transform.Unmarshal }};

    var defaultColors = [
        'rgba(54, 162, 235, 0.6)',
        'rgba(255, 99, 132, 0.6)',
        'rgba(255, 206, 86, 0.6)',
        'rgba(75, 192, 192, 0.6)',
        'rgba(153, 102, 255, 0.6)',
        'rgba(255, 159, 64, 0.6)',
        'rgba(201, 203, 207, 0.6)',
        'rgba(255, 99, 255, 0.6)',
        'rgba(50, 205, 50, 0.6)', 
        'rgba(0, 0, 128, 0.6)'
    ];

    var defaultBorders = [
        'rgba(54, 162, 235, 1)',
        'rgba(255, 99, 132, 1)',
        'rgba(255, 206, 86, 1)',
        'rgba(75, 192, 192, 1)',
        'rgba(153, 102, 255, 1)',
        'rgba(255, 159, 64, 1)',
        'rgba(201, 203, 207, 1)',
        'rgba(255, 99, 255, 1)',
        'rgba(50, 205, 50, 1)',
        'rgba(0, 0, 128, 1)'
    ];

    if (chartConfig.data && chartConfig.data.datasets) {
        chartConfig.data.datasets.forEach(function(dataset, index) {
            if (!dataset.backgroundColor) {
                if (chartConfig.type === 'pie' || chartConfig.type === 'doughnut' || chartConfig.type === 'polarArea') {
                    dataset.backgroundColor = defaultColors;
                    dataset.borderColor = defaultBorders;
                } else {
                    var colorIndex = index % defaultColors.length;
                    dataset.backgroundColor = defaultColors[colorIndex];
                    dataset.borderColor = defaultBorders[colorIndex];
                }
            }
            if (!dataset.borderWidth) {
                dataset.borderWidth = 1;
            }
        });
    }

    if (!chartConfig.options) chartConfig.options = {};
    if (chartConfig.options.responsive === undefined) chartConfig.options.responsive = true;
    if (chartConfig.options.maintainAspectRatio === undefined) chartConfig.options.maintainAspectRatio = false;

    new Chart(ctx, chartConfig);
})();
</script>
