<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Gitea</title><link rel=stylesheet href=/css/style.css type=text/css media=all></head><body><main class=content><h1>Gitea</h1><div class=contenidos><a href=/entradas/>Entradas</a>
<a href=/archivos/>Archivos</a>
<a href=/wallpapers/>Wallpaper</a>
<a href=/problemas>Problemas</a></div><p>Gitea es un programa OpenSource para poder hostear una instancia de un servidor de git, y aprovechando que ya tengo un dominio con una computadora quise hostear mis propios proyectos usando este programa, este programa es de facil instalacion, pero si le quisieras modificar alguna plantilla hay que tener cuidado en que carpeta y usuario lo instala, primero hay que descargar el binario y luego hacerlo ejecutable.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>
</span></span><span style=display:flex><span> wget -O gitea https://dl.gitea.io/gitea/1.18.1/gitea-1.18.1-linux-amd64
</span></span><span style=display:flex><span> chmod +x gitea
</span></span></code></pre></div><p>Luego hay que crear un usuario que ejecute gitea, pues este no puede ser ejecutado por <strong>root</strong>, en la pagina oficial recomiendan el siguiente comando:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span> <span style=color:#a6e22e>adduser</span> <span style=color:#960050;background-color:#1e0010>\</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>--system</span> <span style=color:#960050;background-color:#1e0010>\</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>--shell</span> <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>bin</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>bash</span> <span style=color:#960050;background-color:#1e0010>\</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>--gecos</span> <span style=color:#e6db74>&#39;Git Version Control&#39;</span> <span style=color:#960050;background-color:#1e0010>\</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>--group</span> <span style=color:#960050;background-color:#1e0010>\</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>--disabled-password</span> <span style=color:#960050;background-color:#1e0010>\</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>--home</span> <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>home</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>git</span> <span style=color:#960050;background-color:#1e0010>\</span>
</span></span><span style=display:flex><span> <span style=color:#960050;background-color:#1e0010>**</span><span style=color:#a6e22e>git</span><span style=color:#960050;background-color:#1e0010>**</span>
</span></span></code></pre></div><p>Pero con que este no tenga permisos elevados y una carpeta en <strong>/home</strong> es suficiente, luego necesitamos crear las carpetas <strong>custom,data,log</strong> en <strong>/var/lib/gitea</strong>, y se hace de la siguiente manera en un solo comando.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> mkdir -p /var/lib/gitea/<span style=color:#f92672>{</span>custom,data,log<span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Despues hay que mover el ejecutable de gitea a la carpete de los binarios.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> mv gitea /usr/bin/gitea
</span></span></code></pre></div><p>Luego tenemos que hacer que el usuario que creamos posea estas carpetas, ademas de darle sus permisos especiales. Despues de esto los siguientes comando son para darle permiso al instalador web.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> chown -R git:git /var/lib/gitea/
</span></span><span style=display:flex><span> chmod -R <span style=color:#ae81ff>750</span> /var/lib/gitea/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> mkdir /etc/gitea
</span></span><span style=display:flex><span> chown root:git /etc/gitea
</span></span><span style=display:flex><span> chmod <span style=color:#ae81ff>770</span> /etc/gitea
</span></span></code></pre></div><p>Luego hay que crear un servicio de <strong>systemd</strong>, en el repositorio de gitea hay un ejemplo pero yo tengo otro el cual es un poco diferente, este archivo hay que guardarlo en <strong>/etc/systemd/system</strong> como <strong>gitea.service</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span> [<span style=color:#a6e22e>Unit</span>]
</span></span><span style=display:flex><span> <span style=color:#a6e22e>Description</span>=<span style=color:#a6e22e>Gitea</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>Git</span> <span style=color:#a6e22e>with</span> <span style=color:#a6e22e>a</span> <span style=color:#a6e22e>cup</span> <span style=color:#a6e22e>of</span> <span style=color:#a6e22e>tea</span><span style=color:#960050;background-color:#1e0010>)</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>After</span>=<span style=color:#a6e22e>syslog</span>.<span style=color:#a6e22e>target</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>After</span>=<span style=color:#a6e22e>network</span>.<span style=color:#a6e22e>target</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> [<span style=color:#a6e22e>Service</span>]
</span></span><span style=display:flex><span> <span style=color:#75715e># Uncomment the next line if you have repos with lots of files and get a HTTP 500 error because of that</span>
</span></span><span style=display:flex><span> <span style=color:#75715e># LimitNOFILE=524288:524288</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>RestartSec</span>=<span style=color:#ae81ff>2</span><span style=color:#a6e22e>s</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>Type</span>=<span style=color:#a6e22e>simple</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>User</span>=<span style=color:#960050;background-color:#1e0010>**</span><span style=color:#a6e22e>git</span><span style=color:#960050;background-color:#1e0010>**</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>Group</span>=<span style=color:#960050;background-color:#1e0010>**</span><span style=color:#a6e22e>git</span><span style=color:#960050;background-color:#1e0010>**</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>WorkingDirectory</span>=<span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>var</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>lib</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>gitea</span><span style=color:#960050;background-color:#1e0010>/</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>ExecStart</span>=<span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>usr</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>bin</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>gitea</span> <span style=color:#a6e22e>--config</span> <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>var</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>lib</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>gitea</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>custom</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>conf</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>ini</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>Restart</span>=<span style=color:#a6e22e>always</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>Environment</span>=<span style=color:#a6e22e>USER</span>=<span style=color:#960050;background-color:#1e0010>**</span><span style=color:#a6e22e>git</span><span style=color:#960050;background-color:#1e0010>**</span> <span style=color:#a6e22e>HOME</span>=<span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>home</span><span style=color:#960050;background-color:#1e0010>/**</span><span style=color:#a6e22e>git</span><span style=color:#960050;background-color:#1e0010>**</span> <span style=color:#a6e22e>GITEA</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#a6e22e>_WORK</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#a6e22e>_DIR</span>=<span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>var</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>lib</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>gitea</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> [<span style=color:#a6e22e>Install</span>]
</span></span><span style=display:flex><span> <span style=color:#a6e22e>WantedBy</span>=<span style=color:#a6e22e>multi-user</span>.<span style=color:#a6e22e>target</span>
</span></span></code></pre></div><p>Hay que tener atencion si es que el usuario que se creo para que ejecutara gitea sea el mismo que esta especificado en el servicio de systemd. En este caso estoy haciendo que al momento que gitea se ejecute tome como el archivo de configuracion aquel que esta en <strong>/var/lib/gitea/custom/conf/app.ini</strong>, que en este caso tendriamos que sacar el archivo de configuración desde su github, pues son caso 3,000 lineas de posibles configuraciones y explicaciones sobre su funcionamiento, se have con el siguiente comando.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> curl https://raw.githubusercontent.com/go-gitea/gitea/main/custom/conf/app.example.ini &gt;&gt; app.ini
</span></span><span style=display:flex><span> chmod <span style=color:#ae81ff>640</span> app.ini
</span></span></code></pre></div><p>Y depende en que carpeta estemos hay que mover este archivo a la ubicacion especificada; En este archivo hay cambiar el puerto en el que se ejeucta, el dominio (si es que tenemos uno), en mi caso despues de la instalacion web quedo de la siguiente manera:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span> <span style=color:#a6e22e>APP_NAME</span> = <span style=color:#a6e22e>Senchpimy</span> <span style=color:#a6e22e>Git</span> <span style=color:#a6e22e>Server</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>RUN_USER</span> = <span style=color:#a6e22e>git</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>RUN_MODE</span> = <span style=color:#a6e22e>prod</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> [<span style=color:#a6e22e>repository</span>]
</span></span><span style=display:flex><span> <span style=color:#a6e22e>ROOT</span> = <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>var</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>lib</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>gitea</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>data</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>gitea-repositories</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> [<span style=color:#a6e22e>server</span>]
</span></span><span style=display:flex><span> <span style=color:#a6e22e>DOMAIN</span> = <span style=color:#a6e22e>localhost</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>HTTP_PORT</span> = <span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>ROOT_URL</span> = <span style=color:#a6e22e>https</span><span style=color:#960050;background-color:#1e0010>://</span><span style=color:#a6e22e>git</span>.<span style=color:#a6e22e>senchpimy</span>.<span style=color:#a6e22e>xyz</span>
</span></span></code></pre></div><p>Yo borre algunos campos pues estos tenian información delicada pero esos son los que hay que cambiar, y lo que configure en mi caso, fue para mi dominio que ya tenia.</p><p>Y si todo esta bien configurado solo hay que ejecutar los siguientes comandos.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span> systemctl enable gitea.service
</span></span><span style=display:flex><span> systemctl start gitea.service
</span></span><span style=display:flex><span> 
</span></span></code></pre></div><p>Y ahora si nos dirigimos en este caso seria a senchpimy.xyz:3000, deberiamos ver la pagina de instalacion web, en el tipo de database escogi sqlite, pues solo estare yo usando ese ervidor y no hay necesidad de una databse mas robusta, en este apartado nos dara opcion de modificar las cosas más importantes para que funcione, despues de que ya esta configurado, el servidor ya es usable, en este caso solo desde el puerto <strong>3000</strong> y para cambiar esto hay que hacerlo desde <strong>nginx (más información <a href=./subdominios.html>aqui</a>)</strong>.</p><p>Finalmente me gustaria cambiar la pagina principal que se muestra cuando no hay una cuenta registrada, para lograr esto hay que crear una carpeta llamada <strong>templates</strong> dentro de la carpeta <strong>custom</strong> que creamos en la parte de arriba, y despues hay que crear la template de la que va a remplazar a la original, en este caso seria <strong>home</strong> y por lo tanto hay que guardarlo como <strong>home.tmpl</strong>, Despues hay que copiar el <a href=https://github.com/go-gitea/gitea/blob/main/templates/home.tmpl>ejemplo</a> que esta en el repositorio de gitea, y se supone que es la misma que trae por defecto, pero al momento de cambiarla los siguientes bloques me daban error y no permitian que el servicio completo empezara a ejecutarse</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span> {{.<span style=color:#a6e22e>locale</span>.<span style=color:#a6e22e>Tr</span> <span style=color:#e6db74>&#34;startpage.platform\_desc&#34;</span> | <span style=color:#a6e22e>Str2html</span>}}
</span></span></code></pre></div><p>Asi que solo borre todas las lineas que tuvieran ese contenido, de todos modos era parte de lo que me gustaria haber quitado, y finalmente es un archivo normal de html y este ya se puede modificar como uno quiera. Y para aplicar los cambios hay que <strong>restart</strong> el servicio de gitea.</p><p>Finalmente me quedo asi:</p><p><img src=/pro_img/gitea.png alt></p></main></body></html>