<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Configuracion de Marlin Para la Ender3</title><link rel=stylesheet href=/css/style.css type=text/css media=all></head><body><main class=content><h1>Configuracion de Marlin Para la Ender3</h1><div class=contenidos><a href=/entradas/>Entradas</a>
<a href=/archivos/>Archivos</a>
<a href=/wallpapers/>Wallpaper</a>
<a href=/ascci/main/>ASCCI</a>
<a href=/problemas>Problemas</a></div><p>Con los 4 archivos de configuracion tenemos muchas de modificacion posibilidades para la ender 3, en mi caso hice las siguientes, pues modifique mi impresora desde el hardware agregandole un nuevo hotend (Maxiwatt) y el extrusor BondtechBMG necesita modificaciones al firmware</p><h2 id=_statusscreenh>_Statusscreen.h</h2><p><strong>_statusscreen.h</strong> es un archivo que contiene un bitmap de la pantalla de status que contiene el logo de Marlin, pero como me gusta Serial Experiments Lain se lo voy a cambiar a esta imagen:</p><p><img src=./copland.jpg alt></p><p>Para hacerlo solo subi la imagen <a href=https://marlinfw.org/tools/u8glib/converter.html>https://marlinfw.org/tools/u8glib/converter.html</a> Asegurandome que la imagen cumpliera con las dimensiones y seleccione que la queria para status, copie la salida y la pegue en _Statusscreen.h</p><h2 id=pid>PID</h2><p>Al cambiarle el hotend necesitamos cambiarle el PID que es una formula que controla como el hotend se calienta, evitando que este varie mucho en el tiempo poara poder hacer esto el firmware neceita de tres valores, estos valores se obtiene al hacer una serie de pruebas al calentarse y enfriarse, para poder hacer estas pruebas necesitamos de un programa que pueda enviar Gcode a la placa de la impresora, el programa que utilice se llama <strong>pronterface</strong></p><p>Para poder hacer esta prueba la placa debe estar conectada a la computadora y a la corriente, luego para conectarse a la impresora desde la computadora solo hay que abrir el programa y este va a detectar el puerto, y solo hay que seleccionarlo, probablemente tambien seleccion de forma correcta los demas valores para conectarse si todo esta correcto al momento de dar click en conectar se debera conectar sin errores.</p><p>Al ya estar conectado enviaremos el siguiente texto a la computadora <strong>M303 E0 S205 C7</strong>, lo que este comando de g code significa es lo siguiente</p><ul><li><strong>M303:</strong> Este comando indica que haremos al prueba de calibracion de los valores de PID</li><li><strong>E0:</strong> Esto significa que llevaremos la prueba en el extrusor 0 pues como solo tiene uno mi impresora es el unico que hay que calibrar</li><li><strong>S205:</strong> Significa que el hotend se calentara hast los 205 grados para hacer la prueba</li><li><strong>C7:</strong> Significa que la prueba se llevara a cabo 7 veces, esto es para tener unos valores mas exactos, tambien se pueden hacer menos pero podria llevar a inexatitudes o se podrian hacer mas pero llevaria mas tiempo y puede que las optimizaciones no valgan la pena</li></ul><p>Al finalizar la prueba el programa en mi caso dio la siguiente informacion:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> M303 E0 S215 C7
</span></span><span style=display:flex><span> SENDING:M303 E0 S215 C7
</span></span><span style=display:flex><span> PID Autotune start
</span></span><span style=display:flex><span> bias: <span style=color:#ae81ff>52</span> d: <span style=color:#ae81ff>52</span> min: <span style=color:#ae81ff>214.02</span> max: <span style=color:#ae81ff>223.35</span>
</span></span><span style=display:flex><span> bias: <span style=color:#ae81ff>50</span> d: <span style=color:#ae81ff>50</span> min: <span style=color:#ae81ff>214.14</span> max: <span style=color:#ae81ff>216.67</span> Ku: <span style=color:#ae81ff>50.40</span> Tu: <span style=color:#ae81ff>13.60</span>
</span></span><span style=display:flex><span> Classic PID
</span></span><span style=display:flex><span> Kp: <span style=color:#ae81ff>30.24</span> Ki: <span style=color:#ae81ff>4.45</span> Kd: <span style=color:#ae81ff>51.41</span>
</span></span><span style=display:flex><span> bias: <span style=color:#ae81ff>50</span> d: <span style=color:#ae81ff>50</span> min: <span style=color:#ae81ff>213.83</span> max: <span style=color:#ae81ff>216.41</span> Ku: <span style=color:#ae81ff>49.39</span> Tu: <span style=color:#ae81ff>13.44</span>
</span></span><span style=display:flex><span> Classic PID
</span></span><span style=display:flex><span> Kp: <span style=color:#ae81ff>29.63</span> Ki: <span style=color:#ae81ff>4.41</span> Kd: <span style=color:#ae81ff>49.76</span>
</span></span><span style=display:flex><span> bias: <span style=color:#ae81ff>48</span> d: <span style=color:#ae81ff>48</span> min: <span style=color:#ae81ff>214.22</span> max: <span style=color:#ae81ff>216.20</span> Ku: <span style=color:#ae81ff>61.76</span> Tu: <span style=color:#ae81ff>13.11</span>
</span></span><span style=display:flex><span> Classic PID
</span></span><span style=display:flex><span> Kp: <span style=color:#ae81ff>37.06</span> Ki: <span style=color:#ae81ff>5.65</span> Kd: <span style=color:#ae81ff>60.71</span>
</span></span><span style=display:flex><span> bias: <span style=color:#ae81ff>51</span> d: <span style=color:#ae81ff>51</span> min: <span style=color:#ae81ff>213.75</span> max: <span style=color:#ae81ff>215.94</span> Ku: <span style=color:#ae81ff>59.37</span> Tu: <span style=color:#ae81ff>14.25</span>
</span></span><span style=display:flex><span> Classic PID
</span></span><span style=display:flex><span> Kp: <span style=color:#ae81ff>35.62</span> Ki: <span style=color:#ae81ff>5.00</span> Kd: <span style=color:#ae81ff>63.47</span>
</span></span><span style=display:flex><span> bias: <span style=color:#ae81ff>49</span> d: <span style=color:#ae81ff>49</span> min: <span style=color:#ae81ff>213.98</span> max: <span style=color:#ae81ff>216.20</span> Ku: <span style=color:#ae81ff>56.37</span> Tu: <span style=color:#ae81ff>13.11</span>
</span></span><span style=display:flex><span> Classic PID
</span></span><span style=display:flex><span> Kp: <span style=color:#ae81ff>33.82</span> Ki: <span style=color:#ae81ff>5.16</span> Kd: <span style=color:#ae81ff>55.41</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>**</span>PID Autotune finished<span style=color:#f92672>!</span> Put the last Kp, Ki and Kd constants from below into Configuration.h
</span></span><span style=display:flex><span> <span style=color:#75715e>#define DEFAULT_Kp 33.82
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#75715e>#define DEFAULT_Ki 5.16
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#75715e>#define DEFAULT_Kd 55.41
</span></span></span></code></pre></div><p>Los valores de al final son los que debemos poner en la configuracion de el Marlin, en el archivo Config.h Aproximadamente en la linea 656 es donde empiezan, en mi caso por defecto los valores son los siguientes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-make data-lang=make><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>//</span> <span style=color:#960050;background-color:#1e0010>Creality</span> <span style=color:#960050;background-color:#1e0010>Ender-3</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#if ENABLED(PID_PARAMS_PER_HOTEND)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> // Specify up to one value per hotend here, according to your setup.
</span></span><span style=display:flex><span> // If there are fewer values, the last one applies to the remaining hotends.
</span></span><span style=display:flex><span> <span style=color:#75715e>#define DEFAULT_Kp_LIST { 21.73, 21.73 }</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#define DEFAULT_Ki_LIST { 1.54, 1.54 }</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#define DEFAULT_Kd_LIST { 76.55, 76.55 }</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#else</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#define DEFAULT_Kp 21.73</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#define DEFAULT_Ki 1.54</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#define DEFAULT_Kd 76.55</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#endif</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span></code></pre></div><p>Y como los valores que tengo para el Kp es 33.82, para Ki es 5.16 y para Kd es 55.41 pues son los que cambiare dejando el anterior en lo siguiente:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-make data-lang=make><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>//</span> <span style=color:#960050;background-color:#1e0010>Creality</span> <span style=color:#960050;background-color:#1e0010>Ender-3</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#if ENABLED(PID_PARAMS_PER_HOTEND)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> // Specify up to one value per hotend here, according to your setup.
</span></span><span style=display:flex><span> // If there are fewer values, the last one applies to the remaining hotends.
</span></span><span style=display:flex><span> <span style=color:#75715e>#define DEFAULT_Kp_LIST { 33.82, 33.82 }</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#define DEFAULT_Ki_LIST { 5.16, 5.16 }</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#define DEFAULT_Kd_LIST { 55.41, 55.41 }</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#else</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#define DEFAULT_Kp 33.82</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#define DEFAULT_Ki 5.16</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#define DEFAULT_Kd 55.41</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>#endif</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#endif
</span></span></span></code></pre></div><h2 id=temperatura>Temperatura</h2><p>Cuando cambie de hotend este traia un termistor aparte y como era diferente tenia una resistencia diferente que necesita
ser especificada en el firmware de Marlin, lo que hice fue que en la descripcion de el hotend que compre, este tenia una
descripcion de el termistor que este decia <em><strong>&ldquo;Incluye 100K NTC B 3950 termistor.&rdquo;</strong></em> y solo busque ese modelo y agregue a la busqueda &ldquo;Marlin&rdquo; y encotre que para ese modelo el valor que se tiene que colocar es de <strong>11</strong>, cuando este valo es incorrecto el termistor se puede calentar mucho o poco y cambiar mucho la calidad de las impresiones. Este valor se cambia en la linea 535 en Configuration.h</p><h2 id=extrusor>Extrusor</h2><p>Como cambie el extrusor por defecto a el extrusor BondtechBMG el cual es de extrucion directa, este extrusor necesita una cantidad diferente de pasos para poder extruir la misma cantidad de material, existe una formula para poder tener la cantidad de pasos exactos que especificar, pero al buscar en internet me econtre que para este extrusor la cantidad de pasos son <strong>415</strong> en comparacion a los <strong>93</strong> que tiene por defecto, en este caso no se necesita editar el marlin (aunque se puede) para modificar este valor, en la pantalla de mi ender 3, en <strong>Configuration> AdvancedConfiguration> Steps> Extruder</strong> e ingresamos el valor y lo guardamos, para finalizar solo hay que guardar los cambios para que estos permanezcan despues de que se apague la impresora</p></main></body></html>